<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ token }}</title>
</head>
<body>
<h3>{{ token }} query: </h3>
Current status is:
<div id="status">{{ status }}</div>

<script type="text/javascript">
    const refreshIntervalId = setInterval(updateStatus, 3000);

    function updateStatus() {
        if (document.getElementById("status").innerHTML === 'Done') {
            clearInterval(refreshIntervalId)
        }
        fetch("{{ url('status_update', token=token) }}", {method: 'POST'})
            .then((response) => {
                return response.json();
            })
            .then((data) => {
                document.getElementById("status").innerHTML = data.status;
            });
    }

</script>
</body>
</html>