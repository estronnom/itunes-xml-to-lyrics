<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ token }}</title>
</head>
<body>
<h3>{{ token }} query: </h3>
Current status is:
<div id="status">{{ status }}</div>

<script type="text/javascript">
    function updateStatus() {
        fetch("{{ url('status_update', token=token) }}", {method: 'POST'})
            .then((response) => {
                return response.json();
            })
            .then((data) => {
                document.getElementById("status").innerHTML = data.status;
                if (data.status === 'Done') {
                    const downloadForm = document.createElement("form");
                    downloadForm.setAttribute('action', '')
                    downloadForm.setAttribute('method', 'post')
                    const downloadButton = document.createElement("input");
                    downloadButton.setAttribute('type', 'Submit')
                    downloadButton.setAttribute('value', 'Download')
                    downloadForm.appendChild(downloadButton)
                    const statusDiv = document.getElementById("status")
                    statusDiv.appendChild(downloadForm)
                    clearInterval(refreshIntervalId)
                }
            });
    }

    const refreshIntervalId = setInterval(updateStatus, 3000);
</script>
</body>
</html>